<% stacks.each do |stack| -%>
resource "aws_opsworks_stack" "<%= stack.name %>" {
    color                         = "<%= stack.attributes['Color'] %>"
    default_availability_zone     = "<%= stack.default_availability_zone %>"
    default_instance_profile_arn  = "<%= stack.default_instance_profile_arn %>"
    default_os                    = "<%= stack.default_os %>"
    default_root_device_type      = "<%= stack.default_root_device_type %>"
    default_ssh_key_name          = "<%= stack.default_ssh_key_name %>"
    default_subnet_id             = "<%= stack.default_subnet_id %>"
    hostname_theme                = "<%= stack.hostname_theme %>"
    name                          = "<%= stack.name %>"
    region                        = "<%= stack.region %>"
    service_role_arn              = "<%= stack.service_role_arn %>"
    use_custom_cookbooks          = "<%= stack.use_custom_cookbooks %>"
    use_opsworks_security_groups  = "<%= stack.use_opsworks_security_groups %>"
    vpc_id                        = "<%= stack.vpc_id %>"

    configuration_manager_name    = "<%= stack.configuration_manager.name %>"
    configuration_manager_version = "<%= stack.configuration_manager.version %>"

    berkshelf_version             = "<%= stack.chef_configuration.berkshelf_version %>"
    manage_berkshelf              = "<%= stack.chef_configuration.manage_berkshelf %>"

    custom_cookbooks_source = {
        password                  = "<%= stack.custom_cookbooks_source.password %>"
        revision                  = "<%= stack.custom_cookbooks_source.revision %>"
        ssh_key                   = "<%= stack.custom_cookbooks_source.ssh_key %>"
        type                      = "<%= stack.custom_cookbooks_source.type %>"
        url                       = "<%= stack.custom_cookbooks_source.url %>"
        username                  = "<%= stack.custom_cookbooks_source.username %>"
    }
}
<% end -%>
